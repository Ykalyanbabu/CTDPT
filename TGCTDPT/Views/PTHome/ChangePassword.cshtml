
@{
    ViewBag.Title = "ChangePassword";
    Layout = "~/Views/Shared/_InnerLayout.cshtml";
}

<link href="~/assets/css/custom.css" rel="stylesheet" />

<body>
   

    <div class="container ChangePassword">
        <div class="body-content">
            <div class="password-card fade-in">
                <!-- Card Header -->
                <div class="card-header">
                    <!--<div class="card-icon">
                        <i class="fas fa-key"></i>
                    </div>-->
                    <h2 class="page-title">Change Password</h2>
                    <p class="page-subtitle">Update your account password securely</p>
                </div>

                <!-- Card Body -->
                <div class="card-body">
                    <!-- PTIN Field -->
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-id-card"></i> PTIN
                        </label>
                        <input type="text" class="form-input" value="36440805739" readonly>
                    </div>

                    <!-- Old Password -->
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-lock"></i> Current Password
                        </label>
                        <div class="input-with-icon">
                            <input type="password" class="form-input" id="oldPassword" placeholder="Enter current password">
                            <div class="input-icon">
                                <i class="fas fa-eye" id="toggleOldPassword"></i>
                            </div>
                        </div>
                    </div>

                    <!-- New Password -->
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-key"></i> New Password
                        </label>
                        <div class="input-with-icon">
                            <input type="password" class="form-input" id="newPassword" placeholder="Enter new password">
                            <div class="input-icon">
                                <i class="fas fa-eye" id="toggleNewPassword"></i>
                            </div>
                        </div>

                        <!-- Password Strength Indicator -->
                        <div class="password-strength" id="passwordStrength">
                            <div class="strength-bar">
                                <div class="strength-fill" id="strengthFill"></div>
                            </div>
                            <div class="strength-text" id="strengthText">Password strength</div>
                        </div>
                    </div>

                    <!-- Password Requirements -->
                    <div class="requirements-box" id="passwordRequirements">
                        <ul>
                            <li id="reqLength"><i class="fas fa-circle"></i> Minimum 8 characters</li>
                            <li id="reqAlpha"><i class="fas fa-circle"></i> At least one letter</li>
                            <li id="reqNumber"><i class="fas fa-circle"></i> At least one number</li>
                            <li id="reqMatch"><i class="fas fa-circle"></i> Passwords must match</li>
                        </ul>
                    </div>

                    <!-- Confirm Password -->
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-key"></i> Confirm New Password
                        </label>
                        <div class="input-with-icon">
                            <input type="password" class="form-input" id="confirmPassword" placeholder="Confirm new password">
                            <div class="input-icon">
                                <i class="fas fa-eye" id="toggleConfirmPassword"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Success Message -->
                    <div class="success-message" id="successMessage">
                        <i class="fas fa-check-circle"></i>
                        <h4>Password Changed Successfully!</h4>
                        <p>Your password has been updated. You'll be redirected shortly.</p>
                    </div>

                    <!-- Action Buttons -->
                    <div class="btn-group">
                        <button class="btn btn-primary" id="submitBtn">
                            <i class="fas fa-save"></i> Update Password
                        </button>
                        <button class="btn btn-secondary" id="cancelBtn" onclick="window.history.back()">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

 
    <script src="active.js"></script>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
        $(document).ready(function () {
            // Toggle password visibility
            function setupPasswordToggle(passwordId, toggleId) {
                $(toggleId).click(function () {
                    const passwordInput = $(passwordId);
                    const type = passwordInput.attr('type') === 'password' ? 'text' : 'password';
                    passwordInput.attr('type', type);
                    $(this).toggleClass('fa-eye fa-eye-slash');
                });
            }

            setupPasswordToggle('#oldPassword', '#toggleOldPassword');
            setupPasswordToggle('#newPassword', '#toggleNewPassword');
            setupPasswordToggle('#confirmPassword', '#toggleConfirmPassword');

            // Password strength checker
            @*function checkPasswordStrength(password) {
                let strength = 0;
                const requirements = {
                    length: password.length >= 8,
                    lowercase: /[a-z]/.test(password),
                    uppercase: /[A-Z]/.test(password),
                    number: /\d/.test(password),
                    special: /[!@#$%^&*(),.?":{}|<>]/.test(password)
                };

                if (requirements.length) strength += 20;
                if (requirements.lowercase) strength += 20;
                if (requirements.uppercase) strength += 20;
                if (requirements.number) strength += 20;
                if (requirements.special) strength += 20;

                return strength;
            }*@

            // Update password strength indicator
            $('#newPassword').on('input', function () {
                const password = $(this).val();
                const strength = checkPasswordStrength(password);
                const strengthFill = $('#strengthFill');
                const strengthText = $('#strengthText');

                if (password.length === 0) {
                    $('#passwordStrength').hide();
                    return;
                }

                $('#passwordStrength').show();
                strengthFill.css('width', strength + '%');

                // Update strength text and color
                let text = 'Weak';
                let colorClass = 'weak';

                if (strength >= 80) {
                    text = 'Strong';
                    colorClass = 'strong';
                    strengthFill.css('background', '#20c997');
                } else if (strength >= 60) {
                    text = 'Good';
                    colorClass = 'good';
                    strengthFill.css('background', '#28a745');
                } else if (strength >= 40) {
                    text = 'Fair';
                    colorClass = 'fair';
                    strengthFill.css('background', '#ffc107');
                } else {
                    strengthFill.css('background', '#dc3545');
                }

                strengthText.text(text).removeClass('weak fair good strong').addClass(colorClass);

                // Update requirements indicators
                updateRequirementsIndicators(password);
            });

            // Update requirements indicators
            function updateRequirementsIndicators(password) {
                const confirmPassword = $('#confirmPassword').val();

                // Length requirement
                if (password.length >= 8) {
                    $('#reqLength i').removeClass('fa-circle').addClass('fa-check-circle');
                    $('#reqLength').addClass('valid');
                } else {
                    $('#reqLength i').removeClass('fa-check-circle').addClass('fa-circle');
                    $('#reqLength').removeClass('valid');
                }

                // Alphabet requirement
                if (/[a-zA-Z]/.test(password)) {
                    $('#reqAlpha i').removeClass('fa-circle').addClass('fa-check-circle');
                    $('#reqAlpha').addClass('valid');
                } else {
                    $('#reqAlpha i').removeClass('fa-check-circle').addClass('fa-circle');
                    $('#reqAlpha').removeClass('valid');
                }

                // Number requirement
                if (/\d/.test(password)) {
                    $('#reqNumber i').removeClass('fa-circle').addClass('fa-check-circle');
                    $('#reqNumber').addClass('valid');
                } else {
                    $('#reqNumber i').removeClass('fa-check-circle').addClass('fa-circle');
                    $('#reqNumber').removeClass('valid');
                }

                // Match requirement
                if (password && confirmPassword && password === confirmPassword) {
                    $('#reqMatch i').removeClass('fa-circle').addClass('fa-check-circle');
                    $('#reqMatch').addClass('valid');
                } else {
                    $('#reqMatch i').removeClass('fa-check-circle').addClass('fa-circle');
                    $('#reqMatch').removeClass('valid');
                }
            }

            // Check password match
            $('#confirmPassword').on('input', function () {
                const newPassword = $('#newPassword').val();
                const confirmPassword = $(this).val();
                updateRequirementsIndicators(newPassword);
            });

            // Form submission
            $('#submitBtn').click(function () {
                const oldPassword = $('#oldPassword').val();
                const newPassword = $('#newPassword').val();
                const confirmPassword = $('#confirmPassword').val();

                // Validation
                if (!oldPassword) {
                    alert('Please enter your current password');
                    $('#oldPassword').focus().addClass('shake');
                    setTimeout(() => $('#oldPassword').removeClass('shake'), 500);
                    return;
                }

                if (!newPassword) {
                    alert('Please enter a new password');
                    $('#newPassword').focus().addClass('shake');
                    setTimeout(() => $('#newPassword').removeClass('shake'), 500);
                    return;
                }

                if (newPassword.length < 8) {
                    alert('Password must be at least 8 characters long');
                    $('#newPassword').focus().addClass('shake');
                    setTimeout(() => $('#newPassword').removeClass('shake'), 500);
                    return;
                }

                if (!/[a-zA-Z]/.test(newPassword)) {
                    alert('Password must contain at least one letter');
                    $('#newPassword').focus().addClass('shake');
                    setTimeout(() => $('#newPassword').removeClass('shake'), 500);
                    return;
                }

                if (!/\d/.test(newPassword)) {
                    alert('Password must contain at least one number');
                    $('#newPassword').focus().addClass('shake');
                    setTimeout(() => $('#newPassword').removeClass('shake'), 500);
                    return;
                }

                if (newPassword !== confirmPassword) {
                    alert('New password and confirmation do not match');
                    $('#confirmPassword').focus().addClass('shake');
                    setTimeout(() => $('#confirmPassword').removeClass('shake'), 500);
                    return;
                }

                // Show loading state
                const btn = $(this);
                const originalText = btn.html();
                btn.html('<i class="fas fa-spinner fa-spin"></i> Updating...');
                btn.prop('disabled', true);
                $('#cancelBtn').prop('disabled', true);

                // Simulate API call
                setTimeout(() => {
                    // Show success message
                    $('#successMessage').fadeIn();

                    // Hide form elements
                    $('.form-group').slideUp();
                    $('.requirements-box').slideUp();
                    $('.btn-group').slideUp();

                    // Redirect after delay
                    setTimeout(() => {
                        alert('Password has been changed successfully!');
                        window.location.href = 'dashboard.html'; // Change to your dashboard URL
                    }, 2000);
                }, 1500);
            });
        });
    </script>
</body>